<script>
  function blur_button_click(game_id) {
    var blur_elements = document.getElementsByClassName("blur-content" + game_id);
    var i;
    var j;
    var blur_buttons = document.getElementsByClassName("blur-button" + game_id);
    for (i = 0; i < blur_buttons.length; i++) {
      ele = blur_buttons[i];
      if (ele.classList.contains("blur")){
        ele.innerHTML = "Reveal All";
        ele.classList.remove("blur");
        ele.classList.add("reveal");
        for (j = 0; j < blur_elements.length; j++) {
          blur_element = blur_elements[j]
          if (!blur_element.classList.contains("blurred-content")){
            blur_element.classList.add("blurred-content");
            var mask_container = $(blur_element).closest('.mask_character_length')
            if (mask_container.length){
              $(blur_element).children('.mask_character_output').html('BLANK');
            }
          }
        }
      }
      else {
        ele.innerHTML = "Blur All"
        ele.classList.remove("reveal");
        ele.classList.add("blur");
        for (j = 0; j < blur_elements.length; j++) {
          blur_element = blur_elements[j]
          if (blur_element.classList.contains("blurred-content")){
            blur_element.classList.remove("blurred-content");
            var mask_container = $(blur_element).closest('.mask_character_length')
            if (mask_container.length){
              $(blur_element).children('.mask_character_output').html($(blur_element).children('.mask_character_original_value').html());
            }
          }
        }
      }
    }
  }

  $(document).ready( function () {
    $('.mask_character_length').each(function(){
      if (this.classList.contains("blurred-content")){
        $(this).find('.mask_character_output').html('BLANK');
      }
    })

    $('.last_updated_timestamp').each(function(){
      var start_time = new Date($(this).html()*1000);
      var locale = document.querySelector('html').getAttribute('lang')
      var options = {
        weekday: "short",
        month: "2-digit",
        day: "numeric",
        year: "numeric",
      };
      $(this).html(start_time.toLocaleDateString(locale, options) + " " + start_time.toLocaleTimeString())
    })

    $('.blurred-content').click(function() {
      if (this.classList.contains("blurred-content")){
          this.classList.remove("blurred-content");
          var mask_container = $(this).closest('.mask_character_length')
          if (mask_container.length){
            $(this).children('.mask_character_output').html($(this).children('.mask_character_original_value').html());
          }
      } else {
        this.classList.add("blurred-content");
        $(this).find('.mask_character_output').html('BLANK');
      }
    })

    // $('#game-list-new').DataTable({
    //   "order": [[2, 'desc']],
    //   "autoWidth": false,
    //   "bFilter": false,
    //   "bInfo": false,
    //   "bLengthChange": false,
    //   "bPaginate": true,
    //   "deferRender": true,

    //   "processing": true,
    //   "ajax": {
    //     {% if team is None %}
    //     "url": '/api/completed_games',
    //     {% else %}
    //     "url": '/api/completed_games/{{ team.id }}',
    //     {% endif %}
    //     "dataSrc": 'data'
    //   },
    //   "columns": [
    //     { data: 'home_team_name' },
    //     { data: 'away_team_name' },
    //     { data: 'start_time'},
    //     { data: 'interest_score'},
    //     { data: 'date_from_start_time'},
    //   ],

    //   {% if request.path == '/' %}
    //   "iDisplayLength": 15,
    //   {% else %}
    //   "iDisplayLength": 10,
    //   {% endif %}

    //   "fnDrawCallback": function() {
    //     $("#game-list-new-header").remove();
    //   },
    //   "columnDefs": [
    //     {
    //       // home team
    //       "targets": [0],
    //       "bSortable": false,
    //       "createdCell": function (td, cellData, rowData, row, col) {
    //         $(td).html("<a href='/team/" + rowData.home_team_id + "'>" + rowData.home_team_name + "</a>")
    //       }
    //     },
    //     {
    //       // away team
    //       "targets": [1],
    //       "bSortable": false,
    //       "createdCell": function (td, cellData, rowData, row, col) {
    //         $(td).html("<a href='/team/" + rowData.away_team_id + "'>" + rowData.away_team_name + "</a>")
    //       }
    //     },
    //     {
    //       // start time
    //       "targets": [2],
    //       "bSortable": false,
    //       "createdCell": function (td, cellData, rowData, row, col) {
    //         var start_time = new Date(cellData*1000);
    //         var locale = document.querySelector('html').getAttribute('lang')
    //         var options = {
    //           weekday: "short",
    //           month: "2-digit",
    //           day: "numeric",
    //         };
    //         $(td).html(start_time.toLocaleTimeString())
    //       }
    //     },
    //     {
    //       // severity badge
    //       "targets": [3],
    //       "bSortable": false,
    //       "createdCell": function (td, cellData, rowData, row, col) {
    //         $(td).html(rowData.interest_score)
    //       }
    //     },
    //     {
    //       // date_from_start_time
    //       "bVisible": false,
    //       "aTargets": [4]
    //     }
    //   ],
    //   "rowGroup": {
    //     "dataSrc": function (row) {
    //       return row.date_from_start_time;
    //     }
    //   }
    // });

    $('#game-list-upcoming').DataTable({
      "order": [[2, 'asc']],
      "ordering": false,
      "autoWidth": false,
      "bFilter": false,
      "bInfo": false,
      "bLengthChange": false,
      "bPaginate": true,
      "deferRender": true,

      "processing": true,
      "ajax": {
        {% if team is None %}
        "url": '/api/upcoming_games',
        {% else %}
        "url": '/api/upcoming_games/{{ team.id }}',
        {% endif %}
        "dataSrc": 'data'
      },
      "columns": [
        { data: 'home_team["name"]' },
        { data: 'away_team["name"]' },
        { data: 'start_time'},
        { data: 'date_from_start_time'},
      ],

      {% if request.path == '/' %}
      "iDisplayLength": 15,
      {% else %}
      "iDisplayLength": 10,
      {% endif %}

      "fnDrawCallback": function() {
        $("#game-list-upcoming-header").remove();
      },
      "columnDefs": [
        {
          // home team
          "targets": [0],
          "bSortable": false,
          "createdCell": function (td, cellData, rowData, row, col) {
            $(td).width("30%").css("text-align", "right");
            $(td).html("<a href='/team/" + rowData.home_team.id + "'>" + rowData.home_team.name + "</a>");
          }
        },
        {
          // away team
          "targets": [1],
          "bSortable": false,
          "createdCell": function (td, cellData, rowData, row, col) {
            $(td).width("30%").css("text-align", "left");
            $(td).html("<a href='/team/" + rowData.away_team.id + "'>" + rowData.away_team.name + "</a>");
          }
        },
        {
          // start time
          "targets": [2],
          "bSortable": false,
          "createdCell": function (td, cellData, rowData, row, col) {
            var start_time = new Date(cellData*1000);
            var locale = document.querySelector('html').getAttribute('lang');
            var options = {
              weekday: "short",
              month: "2-digit",
              day: "numeric",
            };
            $(td).width("20%").css("text-align", "center");
            $(td).html(start_time.toLocaleTimeString());
          }
        },
        {
          // date_from_start_time
          "bVisible": false,
          "aTargets": [3]
        }
      ],
      "rowGroup": {
        "dataSrc": function (row) {
          return row.date_from_start_time;
        }
      }
    });

  });
</script>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" href="#completed-games">Completed Games</a></li>
  <li><a data-toggle="tab" href="#upcoming-games">Upcoming Games</a></li>
</ul>

<div class="tab-content">
<!--   <div id="completed-games" class="tab-pane fade in active">
    <table id="game-list-new" class="table table-striped table-bordered table-compact">
      <thead id="game-list-new-header"/>
      <thead/>
    </table>
  </div> -->
  <div id="upcoming-games" class="tab-pane fade">
    <table id="game-list-upcoming" class="table table-striped table-bordered table-compact">
      <thead id="game-list-upcoming-header"/>
      <thead/>
    </table>
  </div>
</div>
